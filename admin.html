<!DOCTYPE html>
<html lang="id" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin – LPPM</title>
  <style>
    :root{--bg:#0b1116;--card:#0f1820;--muted:#8aa0b3;--text:#e6f0f5;--brand:#10b981;--brand-2:#0ea5e9;--line:#1f2a33}
    html{background:var(--bg);color:var(--text)} *{box-sizing:border-box}
    body{margin:0;font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    .container{max-width:900px;margin:auto;padding:18px}
    .btn{border:1px solid var(--line);background:transparent;padding:10px 14px;border-radius:12px;cursor:pointer;color:inherit}
    .btn.primary{background:linear-gradient(135deg,var(--brand),var(--brand-2));border:0;color:#fff}
    .input,.select,textarea{border:1px solid var(--line);background:var(--card);color:inherit;border-radius:12px;padding:12px 12px;width:100%}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .card{border:1px solid var(--line);background:var(--card);padding:16px;border-radius:16px}
    .muted{color:var(--muted)}
    @media (max-width:800px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <h1>Admin – Program LPPM</h1>
    <p class="muted">Set token lalu tambah/hapus program. Data disimpan di storage (Upstash/Vercel KV).</p>

    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div class="row">
          <button class="btn" id="setToken">Set Admin Token</button>
          <span id="tok" class="muted"></span>
        </div>
        <a class="btn" href="/">← Kembali</a>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="grid">
        <input class="input" id="fJudul" placeholder="Judul program *" />
        <input class="input" id="fPI" placeholder="Penanggung jawab / Tim *" />
        <input class="input" id="fURL" placeholder="URL (https://…)" />
        <select class="select" id="fKategori">
          <option>IoT & Computer Vision</option>
          <option>AI & Data Science</option>
          <option>Sistem Informasi</option>
          <option>Ekonomi & Sosial</option>
          <option>Humaniora</option>
        </select>
        <select class="select" id="fTahun">
          <option>2023</option>
          <option>2024</option>
          <option selected>2025</option>
        </select>
        <select class="select" id="fStatus">
          <option>on-going</option>
          <option>completed</option>
          <option>proposal</option>
        </select>
      </div>
      <textarea class="input" id="fRingkas" rows="3" placeholder="Ringkasan singkat…"></textarea>
      <div class="row" style="justify-content:flex-end;margin-top:10px">
        <button class="btn primary" id="btnSimpan">Simpan / Timpa</button>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="row">
        <input class="input" id="delId" placeholder="ID program untuk dihapus (slug judul)" />
        <button class="btn" id="btnHapus">Hapus</button>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = '/api/programs';
    let TOKEN = localStorage.getItem('lppm-admin-token') || '';

    function toId(s){ return s.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'').slice(0,60); }
    function showToken(){ document.getElementById('tok').textContent = TOKEN ? '✔︎ token terset' : '— belum set token'; }

    document.getElementById('setToken').onclick = ()=>{
      const t = prompt('Masukkan ADMIN_TOKEN'); if(!t) return;
      TOKEN = t; localStorage.setItem('lppm-admin-token', t); showToken();
    };

    document.getElementById('btnSimpan').onclick = async ()=>{
      const item = {
        id: toId(document.getElementById('fJudul').value.trim()),
        judul: document.getElementById('fJudul').value.trim(),
        pi: document.getElementById('fPI').value.trim(),
        url: document.getElementById('fURL').value.trim(),
        kategori: document.getElementById('fKategori').value,
        tahun: Number(document.getElementById('fTahun').value),
        status: document.getElementById('fStatus').value,
        ringkas: document.getElementById('fRingkas').value.trim()
      };
      if(!item.id || !item.judul || !item.pi){ alert('Judul & PI wajib.'); return; }
      const r = await fetch(API_BASE, {
        method:'POST', headers:{'Content-Type':'application/json', 'Authorization':'Bearer '+TOKEN},
        body: JSON.stringify(item)
      });
      alert(r.ok?'Tersimpan.':'Gagal simpan.');
    };

    document.getElementById('btnHapus').onclick = async ()=>{
      const id = document.getElementById('delId').value.trim(); if(!id){ alert('Isi ID.'); return; }
      const r = await fetch(API_BASE + '/' + encodeURIComponent(id), {
        method:'DELETE', headers:{'Authorization':'Bearer '+TOKEN}
      });
      alert(r.ok?'Terhapus.':'Gagal hapus.');
    };

    showToken();
  </script>
</body>
</html>
